---
import BootstrapLayout from '../layouts/BootstrapLayout.astro';

const images = [
  { src: '/gallery/IMG_0584.jpeg', alt: 'Warming Shelter Renovation - Image 1' },
  { src: '/gallery/IMG_0585.jpeg', alt: 'Warming Shelter Renovation - Image 2' },
  { src: '/gallery/IMG_0587.jpeg', alt: 'Warming Shelter Renovation - Image 3' },
  { src: '/gallery/IMG_0588.jpeg', alt: 'Warming Shelter Renovation - Image 4' },
  { src: '/gallery/IMG_0589.jpeg', alt: 'Warming Shelter Renovation - Image 5' },
  { src: '/gallery/IMG_0590.jpeg', alt: 'Warming Shelter Renovation - Image 6' },
  { src: '/gallery/IMG_0591.jpeg', alt: 'Warming Shelter Renovation - Image 7' },
  { src: '/gallery/IMG_0593.jpeg', alt: 'Warming Shelter Renovation - Image 8' },
  { src: '/gallery/IMG_0594.jpeg', alt: 'Warming Shelter Renovation - Image 9' },
  { src: '/gallery/IMG_0595.jpeg', alt: 'Warming Shelter Renovation - Image 10' },
];
---

<BootstrapLayout title="Project Gallery - Joshua House Warming Shelter">
  <!-- Gallery Hero Section -->
  <section class="bg-gradient-primary-to-secondary text-white py-5" style="margin-top: 56px;">
    <div class="container px-5 container_plus" >
      <div class="row gx-5 justify-content-center">
        <div class="col-lg-8 text-center">
          <h1 class="display-4 fw-bold mb-4">Warming Shelter Renovation Progress</h1>
          <p class="lead mb-0">
            The work begins! Deconstruction for the new Warming Shelter started Oct. 25.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Gallery Grid Section -->
  <section class="py-5">
    <div class="container px-5">
      <div class="row g-4">
        {images.map((image, index) => (
          <div class="col-lg-4 col-md-6">
            <div class="card border-0 shadow-lg h-100 gallery-card">
              <a href={image.src} class="gallery-link" data-index={index}>
                <img src={image.src} alt={image.alt} class="card-img-top" loading="lazy" style="height: 300px; object-fit: cover;" />
                <div class="gallery-overlay">
                  <i class="bi-zoom-in" style="font-size: 3rem; color: white;"></i>
                </div>
              </a>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox">
    <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
    <button class="lightbox-prev" aria-label="Previous image">&#10094;</button>
    <button class="lightbox-next" aria-label="Next image">&#10095;</button>
    <div class="lightbox-content">
      <img id="lightbox-image" src="" alt="" />
      <div class="lightbox-caption"></div>
    </div>
  </div>
</BootstrapLayout>

<style>
  .gallery-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
    position: relative;
  }

  .gallery-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 1rem 3rem rgba(0, 0, 0, 0.175) !important;
  }

  .gallery-link {
    display: block;
    position: relative;
    text-decoration: none;
    cursor: pointer;
  }

  .gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(44, 95, 124, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .gallery-link:hover .gallery-overlay {
    opacity: 1;
  }

  /* Lightbox Styles */
  .lightbox {
    display: none;
    position: fixed;
    z-index: 9999;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    align-items: center;
    justify-content: center;
  }

  .lightbox.active {
    display: flex;
  }

  .lightbox-content {
    position: relative;
    max-width: 90%;
    max-height: 90%;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .lightbox-content img {
    max-width: 100%;
    max-height: 85vh;
    object-fit: contain;
    border-radius: 8px;
  }

  .lightbox-caption {
    color: white;
    text-align: center;
    padding: 1rem;
    font-size: 1.1rem;
  }

  .lightbox-close,
  .lightbox-prev,
  .lightbox-next {
    position: absolute;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    padding: 1rem;
    transition: background 0.3s ease;
    z-index: 10000;
    border-radius: 4px;
  }

  .lightbox-close:hover,
  .lightbox-prev:hover,
  .lightbox-next:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .lightbox-close {
    top: 20px;
    right: 20px;
    font-size: 3rem;
    line-height: 1;
    padding: 0.5rem 1rem;
  }

  .lightbox-prev {
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
  }

  .lightbox-next {
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
  }

  @media (max-width: 768px) {
    .lightbox-close {
      top: 10px;
      right: 10px;
      font-size: 2rem;
    }

    .lightbox-prev,
    .lightbox-next {
      font-size: 1.5rem;
      padding: 0.5rem;
    }

    .lightbox-prev {
      left: 10px;
    }

    .lightbox-next {
      right: 10px;
    }
  }
</style>

<script>
  const images = [
    { src: '/gallery/IMG_0584.jpeg', alt: 'Warming Shelter Renovation - Image 1' },
    { src: '/gallery/IMG_0585.jpeg', alt: 'Warming Shelter Renovation - Image 2' },
    { src: '/gallery/IMG_0587.jpeg', alt: 'Warming Shelter Renovation - Image 3' },
    { src: '/gallery/IMG_0588.jpeg', alt: 'Warming Shelter Renovation - Image 4' },
    { src: '/gallery/IMG_0589.jpeg', alt: 'Warming Shelter Renovation - Image 5' },
    { src: '/gallery/IMG_0590.jpeg', alt: 'Warming Shelter Renovation - Image 6' },
    { src: '/gallery/IMG_0591.jpeg', alt: 'Warming Shelter Renovation - Image 7' },
    { src: '/gallery/IMG_0593.jpeg', alt: 'Warming Shelter Renovation - Image 8' },
    { src: '/gallery/IMG_0594.jpeg', alt: 'Warming Shelter Renovation - Image 9' },
    { src: '/gallery/IMG_0595.jpeg', alt: 'Warming Shelter Renovation - Image 10' },
  ];

  let currentImageIndex = 0;

  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
  const lightboxCaption = document.querySelector('.lightbox-caption');
  const closeBtn = document.querySelector('.lightbox-close');
  const prevBtn = document.querySelector('.lightbox-prev');
  const nextBtn = document.querySelector('.lightbox-next');
  const galleryLinks = document.querySelectorAll('.gallery-link');

  function openLightbox(index: number) {
    currentImageIndex = index;
    updateLightboxImage();
    lightbox?.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    lightbox?.classList.remove('active');
    document.body.style.overflow = '';
  }

  function updateLightboxImage() {
    const image = images[currentImageIndex];
    if (lightboxImage && lightboxCaption) {
      lightboxImage.src = image.src;
      lightboxImage.alt = image.alt;
      lightboxCaption.textContent = `Image ${currentImageIndex + 1} of ${images.length}`;
    }
  }

  function showPrevImage() {
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    updateLightboxImage();
  }

  function showNextImage() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    updateLightboxImage();
  }

  // Event listeners
  galleryLinks.forEach((link, index) => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      openLightbox(index);
    });
  });

  closeBtn?.addEventListener('click', closeLightbox);
  prevBtn?.addEventListener('click', showPrevImage);
  nextBtn?.addEventListener('click', showNextImage);

  // Close on background click
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') showPrevImage();
    if (e.key === 'ArrowRight') showNextImage();
  });
</script>
</BootstrapLayout>